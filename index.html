<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêù Bee360 - Disparador de Campanhas</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f5f5f5;
            font-family: 'Arial', sans-serif;
        }
        .group-box {
            border: 2px solid #d3d3d3;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
        }
        .group-box h2 {
            font-weight: bold;
            font-size: 1.25rem;
            color: #333;
            margin-bottom: 15px;
        }
        .btn-yellow {
            background-color: #ffeb3b;
            color: #333;
            padding: 10px 20px;
            border-radius: 8px;
            border: 2px solid #d3d3d3;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-yellow:hover {
            background-color: #ffd700;
        }
        input, select, textarea {
            border: 2px solid #d3d3d3;
            border-radius: 5px;
            padding: 8px;
            font-size: 1rem;
            width: 100%;
        }
        textarea {
            resize: vertical;
        }
        .disabled-input {
            background-color: #e5e7eb;
            cursor: not-allowed;
        }
        #contactsList {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #d3d3d3;
            border-radius: 5px;
            padding: 10px;
            background-color: #fff;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-4xl">
        <!-- Title and Description -->
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold text-gray-800"><img src="https://s3.archanjo.co/chatwoot/PNG%20Bee%20High%20resolution%20%28square%29.png" style="width: 50px; height: auto;" alt="Bee360 - Disparador de Campanhas">Bee360 - Disparador</h1>
            <p class="text-sm italic text-gray-600">Configure e dispare campanhas de forma r√°pida e eficiente!</p>
        </div>

        <!-- Configura√ß√£o da Campanha -->
        <div class="group-box">
            <h2>Configura√ß√£o da Campanha</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Conta:</label>
                    <select id="accountCombo" class="w-full">
                        <option>Carregar contas do banco de dados...</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Telefone de Disparo:</label>
                    <select id="inboxCombo" class="w-full">
                        <option>Carregar inboxes...</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Nome da Campanha:</label>
                    <input id="campaignName" type="text" placeholder="Digite o nome da campanha" class="w-full">
                </div>
            </div>
        </div>

        <!-- Segmenta√ß√£o -->
        <div class="group-box">
            <h2>Segmenta√ß√£o</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Disparo:</label>
                    <select id="triggerType" class="w-full" onchange="toggleTriggerOptions()">
                        <option value="etiquetas">Disparo condicional por etiquetas</option>
                        <option value="camposPersonalizados">Disparo condicional por campos personalizados</option>
                        <option value="semConversa">Contatos sem conversa alguma</option>
                        <option value="semInteracao">Mais tempo sem intera√ß√£o</option>
                        <option value="csv">Importar contatos via CSV</option>
                    </select>
                </div>

                <!-- Op√ß√µes para Disparo por Etiquetas -->
                <div id="etiquetasOptions" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Etiqueta para Disparo:</label>
                        <select id="labelCombo" class="w-full">
                            <option>Carregar etiquetas...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Intervalo M√≠nimo desde a √öltima Intera√ß√£o (em dias):</label>
                        <input type="number" placeholder="Ex: 30" class="w-full">
                    </div>
                    <div class="flex items-end gap-2 md:col-span-2">
                        <div class="flex-1">
                            <label class="block text-sm font-medium text-gray-700 mb-1">Quantidade de Contatos:</label>
                            <select id="quantityCombo" class="w-full" onchange="toggleQuantityInput()">
                                <option>Todos</option>
                                <option>Quantidade Espec√≠fica</option>
                            </select>
                        </div>
                        <div class="flex-1">
                            <input id="quantityInput" type="text" placeholder="Digite a quantidade" class="w-full disabled-input" disabled>
                        </div>
                    </div>
                </div>

                <!-- Op√ß√µes para CSV -->
                <div id="csvOptions" class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Arquivo CSV:</label>
                        <input id="csvFile" type="file" accept=".csv" class="w-full" onchange="loadCSV()">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contatos Carregados:</label>
                        <div id="contactsList"></div>
                    </div>
                </div>

                <!-- Outras op√ß√µes (camposPersonalizados, semConversa, semInteracao) permanecem iguais -->
            </div>
        </div>

        <!-- Mensagem da Campanha -->
        <div class="group-box">
            <h2>Mensagem da Campanha</h2>
            <div class="space-y-4">
                <p class="text-sm text-gray-600">Digite a mensagem. Use <code>{nome}</code> para personalizar com o nome do contato.</p>
                <textarea id="messageInput" class="w-full h-24" placeholder="Exemplo: Ol√° {nome}, tudo bem? Confira nossa promo√ß√£o!"></textarea>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Anexar Arquivo (imagem/v√≠deo/√°udio/PDF):</label>
                    <div class="flex gap-2">
                        <input id="fileInput" type="text" placeholder="Nenhum arquivo selecionado" class="flex-1" readonly>
                        <button class="btn-yellow" onclick="selectFile()">Selecionar Arquivo</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-wrap justify-center gap-4">
            <button class="btn-yellow" onclick="previewCampaign()">Visualizar Campanha</button>
            <button class="btn-yellow" onclick="startCampaign()">Iniciar Disparo</button>
            <button class="btn-yellow" onclick="restartCampaign()">Reiniciar Campanha</button>
            <button class="btn-yellow" onclick="showStatus()">Status</button>
            <button class="btn-yellow" onclick="cancelCampaign()">Cancelar</button>
        </div>

        <!-- Copyright -->
        <p class="text-center text-xs italic text-gray-500 mt-6">¬© 2025 Bee360 - Desenvolvido por Jonas Flores (@jonasvflores)</p>
    </div>

    <script>
        let contacts = [];

        function toggleTriggerOptions() {
            const triggerType = document.getElementById('triggerType').value;
            document.getElementById('etiquetasOptions').classList.add('hidden');
            document.getElementById('csvOptions').classList.add('hidden');
            if (triggerType === 'etiquetas') {
                document.getElementById('etiquetasOptions').classList.remove('hidden');
            } else if (triggerType === 'csv') {
                document.getElementById('csvOptions').classList.remove('hidden');
            }
        }

        function toggleQuantityInput() {
            const quantityCombo = document.getElementById('quantityCombo');
            const quantityInput = document.getElementById('quantityInput');
            if (quantityCombo.value === 'Quantidade Espec√≠fica') {
                quantityInput.disabled = false;
                quantityInput.classList.remove('disabled-input');
            } else {
                quantityInput.disabled = true;
                quantityInput.classList.add('disabled-input');
                quantityInput.value = '';
            }
        }

        function loadCSV() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                contacts = parseCSV(text);
                displayContacts();
            };
            reader.readAsText(file);
        }

        function parseCSV(text) {
            const lines = text.split('\n').filter(line => line.trim() !== '');
            const headers = lines[0].split(',').map(header => header.trim());
            if (!headers.includes('nome') || !headers.includes('telefone')) {
                alert('O CSV deve conter as colunas "nome" e "telefone".');
                return [];
            }

            const result = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(value => value.trim());
                const contact = {};
                headers.forEach((header, index) => {
                    contact[header] = values[index];
                });
                result.push(contact);
            }
            return result;
        }

        function displayContacts() {
            const contactsList = document.getElementById('contactsList');
            contactsList.innerHTML = '';
            if (contacts.length === 0) {
                contactsList.innerHTML = '<p>Nenhum contato carregado.</p>';
                return;
            }

            const ul = document.createElement('ul');
            contacts.forEach(contact => {
                const li = document.createElement('li');
                li.textContent = `${contact.nome} - ${contact.telefone}`;
                ul.appendChild(li);
            });
            contactsList.appendChild(ul);
            alert(`${contacts.length} contatos carregados com sucesso!`);
        }

        function selectFile() {
            alert('Funcionalidade de sele√ß√£o de arquivo ser√° implementada no backend.');
        }

        function previewCampaign() {
            const campaignName = document.getElementById('campaignName').value;
            const message = document.getElementById('messageInput').value;
            const triggerType = document.getElementById('triggerType').value;
            let previewText = `Nome: ${campaignName}\nMensagem: ${message}`;
            if (triggerType === 'csv' && contacts.length > 0) {
                previewText += `\nContatos: ${contacts.length} carregados do CSV`;
            }
            alert(`Pr√©via:\n${previewText}`);
        }

        function startCampaign() {
            if (document.getElementById('triggerType').value === 'csv' && contacts.length > 0) {
                alert(`Iniciando disparo para ${contacts.length} contatos do CSV! (Necessita de backend para integra√ß√£o com Chatwoot)`);
            } else {
                alert('Disparo iniciado! (Necessita de backend para integra√ß√£o com Chatwoot)');
            }
        }

        function restartCampaign() {
            document.getElementById('campaignName').value = '';
            document.getElementById('messageInput').value = '';
            document.getElementById('fileInput').value = '';
            document.getElementById('csvFile').value = '';
            contacts = [];
            displayContacts();
            alert('Campanha reiniciada!');
        }

        function showStatus() {
            alert('Status da campanha ser√° exibido aqui.');
        }

        function cancelCampaign() {
            alert('Configura√ß√£o da campanha cancelada.');
        }
    </script>
</body>
</html>
